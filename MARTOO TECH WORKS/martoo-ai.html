<!DOCTYPE html>  
<html lang="en">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>  
  <title>Martoo AI Assistant</title>  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>  
  <!-- Firebase compatibility SDKs as specified -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>  
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>  
  <style>  
    /* existing styles preserved... */  
    body {                      
      margin: 0;                      
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;                      
      background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.9)), url('full-site-background.jpg') no-repeat center center fixed;                      
      background-size: cover;                      
      color: white;                      
      overflow-x: hidden;                      
    }                      
    header {                      
      position: relative;                      
      text-align: center;                      
      padding: 40px 20px;                      
      background: rgba(0, 0, 0, 0.85);                      
      box-shadow: 0 4px 12px rgba(0, 255, 255, 0.15);                      
    }                      
    header h1 {                      
      color: #00ffcc;                      
      font-size: 36px;                      
      margin: 0;                      
    }                      
    .hamburger {                      
      position: absolute;                      
      top: 20px;                      
      right: 20px;                      
      font-size: 28px;                      
      color: white;                      
      cursor: pointer;                      
      padding: 8px;                      
      border: 2px solid #00ffcc;                      
      border-radius: 5px;                      
      background: rgba(0, 0, 0, 0.6);                      
      user-select: none;                      
      z-index: 1000;                      
    }                      
    nav ul {                      
      list-style: none;                      
      padding: 0;                      
      margin: 0;                      
      position: absolute;                      
      top: 70px;                      
      right: 20px;                      
      width: 200px;                      
      background: rgba(0, 0, 0, 0.95);                      
      display: none;                      
      flex-direction: column;                      
      border-radius: 10px;                      
      box-shadow: 0 6px 16px rgba(0, 255, 255, 0.2);                      
      max-height: 300px;                      
      overflow-y: auto;                      
      z-index: 999;                      
    }                      
    nav ul.show {                      
      display: flex;                      
    }                      
    nav ul li a {                      
      color: white;                      
      text-decoration: none;                      
      padding: 14px;                      
      display: block;                      
      border-bottom: 1px solid #333;                      
    }                      
    nav ul li a:hover {                      
      background-color: #00ffcc;                      
      color: #000;                      
    }                      
                      
    .chat-container {                      
      max-width: 700px;                      
      margin: 50px auto;                      
      background: rgba(0, 0, 0, 0.7);                      
      padding: 30px;                      
      border-radius: 15px;                      
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);                      
    }                      
    .chat-box {                      
      height: 300px;                      
      overflow-y: auto;                      
      border: 1px solid #00ffcc;                      
      border-radius: 8px;                      
      padding: 15px;                      
      background-color: #111;                      
    }                      
    .chat-box p {                      
      margin: 10px 0;                      
      line-height: 1.5;                      
      word-wrap: break-word;                      
    }                      
    .user { color: #ffcc00; }                      
    .ai { color: #00ffcc; font-weight: bold; }                      
                      
    .chat-input {                      
      margin-top: 20px;                      
      display: flex;                      
      gap: 10px;                      
      flex-wrap: wrap;                      
    }                      
                      
    input[type="text"], input[type="file"] {                      
      flex: 1;                      
      padding: 12px;                      
      font-size: 16px;                      
      border-radius: 6px;                      
      border: none;                      
    }                      
                      
    button {                      
      padding: 12px 20px;                      
      background-color: #00bfff;                      
      color: white;                      
      border: none;                      
      border-radius: 6px;                      
      cursor: pointer;                      
    }                      
                      
    footer {                      
      text-align: center;                      
      padding: 20px;                      
      font-size: 14px;                      
      background: #111;                      
    }                      
                      
    @media (max-width: 480px) {                      
      nav ul { width: 150px; right: 10px; }                      
      header h1 { font-size: 28px; }                      
      .chat-container { margin: 20px 10px; padding: 20px; }                      
    }                      
                      
    #preview-img {                      
      margin-top: 10px;                      
      max-width: 100%;                      
      border-radius: 10px;                      
      display: none; /* Hidden by default */
    }

    /* Styles for the login popup, integrated with your existing CSS */
    #login-popup {  
      display: none;  
      position: fixed;  
      top: 0; left: 0;  
      width: 100%; height: 100%;  
      background: rgba(0,0,0,0.85);  
      z-index: 1001;  
      justify-content: center;  
      align-items: center;  
    }  
    #login-popup.show {  
      display: flex;  
    }  
    .login-box {  
      background: #111;  
      padding: 30px;  
      border-radius: 10px;  
      box-shadow: 0 0 15px #00ffcc;  
      color: white;  
      width: 300px;  
      text-align: center;  
    }  
    .login-box input {  
      display: block;  
      margin: 10px auto;  
      padding: 10px;  
      width: 90%;  
      border: none;  
      border-radius: 5px;  
      background-color: #333; /* Added to blend with dark theme */
      color: white; /* Added to blend with dark theme */
    }  
    .login-box button {  
      margin-top: 10px;  
      width: 100%;
      /* Preserve existing button styles, add some margin */
      padding: 12px 20px;                      
      background-color: #00bfff;                      
      color: white;                      
      border: none;                      
      border-radius: 6px;                      
      cursor: pointer;
    }

    /* Custom message box style (replaces alert) */
    #custom-message-box {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: rgba(0, 0, 0, 0.85);
        color: white;
        padding: 15px 25px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 255, 255, 0.2);
        z-index: 1002;
        display: none; /* Hidden by default */
        font-size: 16px;
        max-width: 300px;
        text-align: center;
    }
  </style>  
</head>  
<body>  
  <header>  
    <h1>Martoo AI Assistant</h1>  
    <div class="hamburger" onclick="toggleMenu()">‚ò∞</div>  
    <nav>  
      <ul id="menu">  
        <li><a href="index.html">Home</a></li>  
        <li><a href="posts.html">Blog</a></li>  
        <li><a href="services.html">Services</a></li>  
        <li><a href="typing_assistant.html">Typing Assistant</a></li>  
        <li><a href="about.html">About</a></li>  
        <li><a href="contact.html">Contact</a></li>  
        <li><a href="downloader.html">Downloader</a></li>  
      </ul>  
    </nav>  
  </header>  
  
  <div class="chat-container">  
    <div class="chat-box" id="chat-box"></div>  
    <div class="chat-input">  
      <input type="text" id="user-input" placeholder="Ask Martoo AI anything..." autocomplete="off"/>  
      <input type="file" id="file-input" accept="image/*" />  
      <button onclick="sendMessage()">Send</button>  
      <button onclick="startDictation()"><i class="fas fa-microphone"></i></button>  
    </div>  
    <img id="preview-img" />  
  </div>  
  
  <!-- Login Popup - Added as requested -->
  <div id="login-popup">  
    <div class="login-box">  
      <h3>Login to continue</h3>  
      <input type="email" id="login-email" placeholder="Email" />  
      <input type="password" id="login-password" placeholder="Password" />  
      <button onclick="loginUser()">Login</button>  
      <button onclick="googleSignIn()" style="background:#db4437;"><i class="fab fa-google"></i> Login with Google</button>  
      <button onclick="hideLoginPopup()" style="background-color: #555; margin-top: 15px;">Continue as Anonymous</button>
    </div>  
  </div>
  
  <footer>&copy; 2024‚Äì2025 | Martoo Tech Works. All rights reserved.</footer>  

  <!-- Custom Message Box (replaces alert()) -->
  <div id="custom-message-box"></div>
  
  <script>  
    // Firebase Configuration - Using your provided config
    const firebaseConfig = {            
      apiKey: "AIzaSyCeAWDcPLubp8a8D6uqUwwXeMR6ZlRN3Hc",            
      authDomain: "martoo-ai-assistant.firebaseapp.com",            
      projectId: "martoo-ai-assistant",            
      storageBucket: "martoo-ai-assistant.firebasestorage.app",            
      messagingSenderId: "833564475751",            
      appId: "1:833564475751:web:6b9318c39264f4f78f2fc2"            
    };            
    // Initialize Firebase using the compatibility layer
    firebase.initializeApp(firebaseConfig);            
    const auth = firebase.auth();

    // Global state variables for chat count and login status
    let chatCount = 0;  
    let loggedIn = false;  
    const chatBox = document.getElementById("chat-box");  
    const loginPopup = document.getElementById("login-popup");

    // Function to display custom messages instead of alert()
    function showCustomMessage(message) {
        const msgBox = document.getElementById('custom-message-box');
        msgBox.textContent = message;
        msgBox.style.display = 'block';
        setTimeout(() => {
            msgBox.style.display = 'none';
        }, 3000); // Hide after 3 seconds
    }

    // Function to hide the login popup
    function hideLoginPopup() {
        loginPopup.classList.remove("show");
    }

    // Hamburger menu toggle
    function toggleMenu() {                      
      document.getElementById("menu").classList.toggle("show");                      
    }                      
                      
    // Restore old messages from localStorage and set up auth state listener on window load
    window.onload = () => {                      
      const saved = localStorage.getItem("martooChat");                      
      if (saved) chatBox.innerHTML = saved;                      
      else chatBox.innerHTML = `<p><span class="ai">Martoo AI:</span> Hello üëã I‚Äôm here to help. Ask me anything!</p>`;
      
      // Firebase Auth State Listener
      auth.onAuthStateChanged(user => {  
        if (user) {  
          loggedIn = true;  
          chatCount = 0; // Reset chat count if user logs in
          hideLoginPopup(); // Hide popup if user is logged in
          console.log("User is logged in:", user.email || user.uid);
        } else {
          loggedIn = false;
          console.log("User is logged out.");
        }
      });
    };                      
                      
    // Close menu when navigation link is clicked
    document.querySelectorAll("nav ul li a").forEach(link => {                      
      link.addEventListener("click", () => document.getElementById("menu").classList.remove("show"));                      
    });                      
                      
    // Send message on Enter key press
    document.getElementById("user-input").addEventListener("keydown", e => {                      
      if (e.key === "Enter") sendMessage();                      
    });                      
                      
    // Image file input preview
    document.getElementById("file-input").addEventListener("change", e => {                      
      const file = e.target.files[0];                      
      const previewImg = document.getElementById("preview-img");
      if (file) {                      
        const reader = new FileReader();                      
        reader.onload = e => {
          previewImg.src = e.target.result;
          previewImg.style.display = 'block'; // Show the image preview
        };                      
        reader.readAsDataURL(file);                      
      } else {
          previewImg.src = '';
          previewImg.style.display = 'none'; // Hide the image preview if no file selected
      }
    });                      
                      
    async function sendMessage() {
      // Check for login status and chat limit
      if (!loggedIn && chatCount >= 5) {  
        loginPopup.classList.add("show"); // Show the login popup
        return; // Stop message sending if not logged in and limit reached
      }  
  
      const input = document.getElementById("user-input");                      
      const message = input.value.trim();                      
      if (!message) return;                      
      
      // Increment chat count for non-logged-in users
      if (!loggedIn) {
          chatCount++;
      }

      const userMessage = document.createElement("p");                      
      userMessage.innerHTML = `<span class="user">You:</span> ${message}`;                      
      chatBox.appendChild(userMessage);                      
                      
      const loading = document.createElement("p");                      
      loading.innerHTML = `<span class="ai">Martoo AI:</span> <em>Typing...</em>`;                      
      chatBox.appendChild(loading);                      
      chatBox.scrollTop = chatBox.scrollHeight;                      
                      
      try {                      
        // Using your specified backend API
        const res = await fetch("https://martoo-tech-backend.vercel.app/api/chat", {  
          method: "POST",                      
          headers: { "Content-Type": "application/json" },                      
          body: JSON.stringify({ message })  
        });                      
        const data = await res.json();                      
        loading.innerHTML = `<span class="ai">Martoo AI:</span> ***${data.reply || "‚ö†Ô∏è No response."}***`;                      
        input.value = "";                      
      } catch (err) {                      
        console.error("Error connecting to backend:", err);                      
        loading.innerHTML = `<span class="ai">Martoo AI:</span> ‚ö†Ô∏è Error connecting to server.`;                      
      } finally {
        // Clear file input and hide preview after sending
        document.getElementById('file-input').value = '';
        document.getElementById('preview-img').src = '';
        document.getElementById('preview-img').style.display = 'none';
      }
                      
      chatBox.scrollTop = chatBox.scrollHeight;                      
      localStorage.setItem("martooChat", chatBox.innerHTML);                      
    }                      
                      
    function startDictation() {                      
      if (!('webkitSpeechRecognition' in window)) {
        showCustomMessage("Speech recognition not supported in this browser."); // Use custom message
        return;
      }
      const recognition = new webkitSpeechRecognition();                      
      recognition.lang = "en-US";                      
      recognition.continuous = false;                      
      recognition.interimResults = false;                      
      recognition.onresult = e => {                      
        document.getElementById("user-input").value = e.results[0][0].transcript;                      
        sendMessage();                      
      };                      
      recognition.onerror = e => {
        showCustomMessage("Speech error: " + e.error); // Use custom message
        console.error("Speech recognition error:", e.error);
      };                      
      recognition.start();                      
    }                      
                      
    // Login with Email and Password
    function loginUser() {  
      const email = document.getElementById("login-email").value;  
      const password = document.getElementById("login-password").value;  
      auth.signInWithEmailAndPassword(email, password)  
        .then(() => {  
          // onAuthStateChanged will handle loggedIn status and popup removal
          showCustomMessage("Login successful!");
        })  
        .catch(err => {
          showCustomMessage("Login error: " + err.message);
          console.error("Email/Password Login Error:", err);
        });  
    }  
                      
    // Login with Google
    function googleSignIn() {  
      const provider = new firebase.auth.GoogleAuthProvider();  
      auth.signInWithPopup(provider)  
        .then(() => {  
          // onAuthStateChanged will handle loggedIn status and popup removal
          showCustomMessage("Google login successful!");
        })  
        .catch(err => {
          showCustomMessage("Google login error: " + err.message);
          console.error("Google Login Error:", err);
        });  
    }  
  </script>  
</body>  
</html>

